# ⛏️ War for the Overworld - 完整挖掘系统图鉴

## 📚 图鉴概述

本图鉴详细介绍了 War for the Overworld 世界中的完整挖掘系统，从勤劳的哥布林苦工到珍贵的黄金矿脉，从基础的挖掘机制到高级的资源管理。通过深入了解挖掘系统的各个方面，你将能够建立强大的经济基础，为地下城的扩张提供充足的资源！

### 🎮 游戏内访问
在游戏中按 **5键** 可以召唤哥布林苦工，支持以下功能：
- ⛏️ **自动挖掘**: 苦工会自动寻找并挖掘黄金矿脉
- 📊 **状态显示**: 状态指示器显示苦工的工作状态
- 💰 **资源收集**: 自动将挖掘的黄金运回地牢之心
- 🏃 **智能逃跑**: 遇到敌人时自动逃离保命
- 🏗️ **工程师支持**: 地精工程师协助挖掘系统，提供建造支持

## 📊 挖掘单位总览

### 🆕 哥布林苦工 (Goblin Worker)
- **成本**: 80金币
- **生命值**: 600
- **攻击力**: 8 (较弱)
- **移动速度**: 20 (中等)
- **携带容量**: 20金币
- **挖掘效率**: 每1秒挖掘2金币
- **智能存储**: 携带容量达到100%（20金币）时自动存储
- **颜色**: 浅绿色 (#8fbc8f)
- **体型**: 中等 (12像素)
- **特殊标识**: 竖向空心长方形状态指示器
- **战斗单位**: 否（非战斗单位）


## 🏗️ 挖掘系统机制

### 1. 黄金矿脉生成
- **生成概率**: 8% 的岩石含有黄金矿脉
- **储量**: 每个矿脉含有500单位黄金
- **发现方式**: 挖掘岩石时有概率发现
- **视觉标识**: 金色岩石 + ⚡ 符号

### 2. 哥布林苦工行为
**AI优先级**:
1. **WorkerAssigner任务** - 最高优先级（训练任务等）
2. **逃离敌人** - 安全第二（60像素检测范围）
3. **存储金币** - 当携带金币达到最大容量时
4. **挖掘金矿** - 主要工作，自主寻找金矿
5. **游荡** - 空闲状态，寻找新目标
6. **智能状态切换** - 等待超时自动进入游荡状态

### 🎲 苦工状态切换器

#### 核心功能
哥布林苦工状态切换器确保苦工不会长时间停留在空闲状态，自动触发游荡行为。

#### 工作原理
```python
# 苦工状态切换器配置
waiting_timeout = 2.0秒          # 等待超时时间
state_change_cooldown = 0.5秒    # 状态切换冷却时间
waiting_states = ['idle', 'wandering']
```

#### 切换逻辑
1. **等待状态检测**: 监控苦工是否处于空闲或游荡状态
2. **超时判断**: 等待超过2秒后触发状态切换
3. **自动游荡**: 切换到WorkerStatus.WANDERING状态
4. **工作保持**: 游荡时继续寻找金矿，保持工作效率

#### 兼容性设计
- **重写状态切换器**: 保持苦工特有的工作逻辑
- **任务优先级**: 工作优先于游荡，持续寻找新目标
- **状态管理**: 使用WorkerStatus枚举，与现有系统兼容

### 3. 挖掘过程
- **寻找目标**: 自动搜索附近的黄金矿脉
- **移动到矿脉**: 使用路径查找到达挖掘点
- **开始挖掘**: 到达后自动开始挖掘作业
- **挖掘效率**: 每1秒挖掘2金币
- **智能存储**: 携带容量达到100%（20金币）时自动前往存储
- **矿脉枯竭**: 挖完后变成枯竭矿脉

## 🎮 游戏玩法

### 召唤哥布林苦工
1. 点击右上角的 "🔨 召唤哥布林苦工 (80金)" 按钮
2. 在已挖掘的地面或房间中点击放置
3. 哥布林苦工会自动寻找并挖掘黄金矿脉

### 发现黄金矿脉
1. 使用挖掘工具开辟新区域
2. 有8%概率发现黄金矿脉
3. 发现时会有特殊的金色特效和提示音

### 资源管理
- **黄金收集**: 挖掘的黄金直接存储到地牢之心
- **自动挖掘**: 哥布林苦工会自动工作
- **效率提升**: 多个哥布林苦工可以同时工作

## 🔧 技术实现

### 地图数据结构
每个瓦片包含以下信息：
- 瓦片类型
- 黄金储量
- 是否为金矿
- 是否正在被挖掘
- 是否已被发现

### 哥布林苦工状态机
```
idle → moving_to_mine → mining → idle
  ↑                               ↓
  ← fleeing ← enemy_detected ←----
```

### 挖掘算法
挖掘数量 = min(矿脉储量, 挖掘速度 × 挖掘效率)

## 🎯 战略价值

### 经济系统
- **新的收入来源**: 通过挖掘获得额外黄金收入
- **主动资源管理**: 需要玩家主动探索和开发
- **风险回报**: 哥布林苦工较弱，需要保护

### 战术考量
- **保护苦工**: 哥布林苦工战斗力弱，需要其他怪物保护
- **资源分配**: 在战斗单位和经济单位之间平衡
- **地图控制**: 需要扩展领土寻找更多矿脉

## 📊 平衡性设计

### 经济平衡
- **投资回报**: 80金投入，可挖掘500金黄金
- **时间成本**: 约250秒挖完一个矿脉（已优化）
- **风险因素**: 容易被英雄击杀

## 🎨 视觉设计

### 哥布林苦工
- **体型**: 比其他怪物小 (12像素)
- **颜色**: 浅绿色，区别于其他怪物
- **状态指示器**: 使用统一的状态指示器系统 (StatusIndicator)
  - **指示器规格**: 竖向空心长方形 (4x8像素)
  - **颜色编码**: 
    - 🟢 绿色边框: 移动中 / 移动到挖掘点 (MOVING_TO_MINE)
    - 🟤 深棕色边框: 挖掘中 (MINING)
    - ⚫ 深灰色边框: 逃跑中 (FLEEING)
    - 🔴 红色边框: 战斗中 (FIGHTING)
    - 🔵 青色边框: 返回基地 (RETURNING_TO_BASE)
    - 🟠 橙色边框: 游荡中 (WANDERING)
    - ⚪ 白色边框: 空闲 (IDLE)
    - 🟢 绿色边框: 前往训练 (MOVING_TO_TRAINING)
    - 🟤 深棕色边框: 训练中 (TRAINING)
  - **技术实现**: 基于StatusIndicator类，支持自定义扩展

### 黄金矿脉
- **未发现**: 普通灰色岩石
- **已发现**: 金色岩石 + ⚡ 符号
- **挖掘中**: 彩色边框指示器（通过StatusIndicator系统实现）
  - 🟢 绿色边框: 正常挖掘 (1个挖掘者)
  - 🟡 黄色边框: 较多挖掘者 (2个挖掘者)
  - 🔴 红色边框: 满员 (3个挖掘者)
- **已枯竭**: 棕色岩石
- **状态高亮**: 只绘制边框，不填充中间区域，保持矿脉外观清晰

## 🚀 使用技巧

### 新手指南
1. **优先探索**: 多挖掘寻找黄金矿脉
2. **早期投资**: 优先召唤1-2个哥布林苦工
3. **保护苦工**: 在苦工附近放置战斗怪物
4. **资源管理**: 合理分配挖掘区域和防御力量

### 进阶策略
1. **矿脉地图**: 记住已发现矿脉的位置
2. **工作分配**: 为每个苦工分配不同的挖掘区域
3. **防御布置**: 在矿区设置陷阱和防御
4. **经济循环**: 用挖掘收入招募更多苦工

## 🔍 调试功能

### 调试模式 (按P键)
- **统计信息**: 哥布林苦工总数、正在挖掘数量
- **矿脉状态**: 活跃金矿、枯竭金矿数量
- **资源统计**: 黄金储量、金币储量
- **苦工状态**: 每个苦工的详细状态和携带金币
- **效率分析**: 平均携带量等性能指标

### 调试信息
- 哥布林苦工状态变化和位置
- 矿脉发现和枯竭事件
- 挖掘效率和收益统计
- 实时黄金储量数据
- 苦工AI行为分析

---

## 📝 更新日志

### v2.3 - 金库存储系统优化版本
- ✅ **金库维护成本修复**: 金库不再消耗金币，维护成本设置为0
- ✅ **资源面板集成**: 金库中存储的金币现在会显示在总金币中
- ✅ **存储逻辑优化**: 金库作为纯存储设施，不产生被动收入也不消耗维护成本
- ✅ **UI显示改进**: 资源面板显示包括金库存储的总金币数量

### v2.2 - 状态指示器系统重构版本
- ✅ **系统重构**: 状态指示器整合为独立的StatusIndicator类
- ✅ **统一接口**: 所有生物使用相同的状态指示器系统
- ✅ **可扩展性**: 支持自定义状态和颜色配置
- ✅ **文档完善**: 新增STATUS_INDICATOR.md技术文档

### v2.1 - 状态指示器颜色优化版本
- ✅ **状态指示器颜色调整**: 逃跑中改为深灰色，空闲改为白色
- ✅ **视觉对比度提升**: 优化状态指示器的可见性和区分度

### v2.0 - 视觉优化版本
- ✅ **状态指示器优化**: 改为竖向空心长方形 (4x8像素)
- ✅ **挖掘效率提升**: 从每2秒1单位提升到每1秒2单位 (4倍效率)
- ✅ **界面简化**: 移除苦工身上的金币显示，减少视觉干扰
- ✅ **调试功能增强**: 新增详细的统计信息和性能分析
- ✅ **矿脉视觉改进**: 彩色边框指示器显示挖掘状态

### v1.0 - 基础版本
- ✅ **核心功能**: 哥布林苦工AI行为系统
- ✅ **资源管理**: 黄金收集和存储
- ✅ **矿脉系统**: 8%概率生成，500单位储量
- ✅ **视觉反馈**: 基础状态指示和矿脉标识

---

## 🎉 享受新的挖掘体验！

哥布林苦工为游戏增加了全新的经济维度，让资源管理更加丰富和有趣。合理利用这些勤劳的小家伙，建立强大的地下经济帝国！⛏️💰👹