# ⚔️ War for the Overworld - 完整战斗系统图鉴

## 📚 图鉴概述

本图鉴详细介绍了 War for the Overworld 世界中的完整战斗系统，从基础的攻击机制到复杂的战术策略，从单体对决到团队协作。通过深入了解战斗系统的各个方面，你将能够制定出更有效的战斗策略，在地下城的争夺战中获得胜利！

### 🎮 游戏内访问
在游戏中战斗会自动触发，支持以下功能：
- ⚔️ **自动战斗**: 单位会自动寻找并攻击敌人
- 🎯 **智能AI**: 不同单位有不同的战斗优先级
- 📊 **实时反馈**: 状态指示器显示战斗状态
- 🔄 **物理效果**: 击退、碰撞等真实物理交互
- 🏗️ **工程师管理**: 工程师在战斗中的状态管理和自动拒绝多余工程师

## 📊 战斗单位总览

### 👹 地下生物战斗一览表

| 生物类型   | 战斗等级 | 成本  | 生命值 | 攻击力 | 护甲值 | 移动速度 | 攻击范围 | 追击范围 | 攻击速度 | 特殊能力 |
| ---------- | -------- | ----- | ------ | ------ | ------ | -------- | -------- | -------- | -------- | -------- |
| 哥布林苦工 | ⭐        | 80金  | 600    | 8      | 0      | 20       | 30像素   | 无       | 1.0秒    | 挖掘逃跑 |
| 地精工程师 | ⭐⭐       | 100金 | 800    | 12     | 2      | 18       | 100像素  | 无       | 1.0秒    | 建造陷阱 |
| 小恶魔     | ⭐⭐       | 100金 | 800    | 15     | 2      | 25       | 30像素   | 75像素   | 1.0秒    | 基础战斗 |
| 石像鬼     | ⭐⭐⭐      | 150金 | 1200   | 25     | 6      | 18       | 35像素   | 88像素   | 1.2秒    | 重击攻击 |
| 火蜥蜴     | ⭐⭐⭐      | 200金 | 1000   | 28     | 3      | 22       | 85像素   | 85像素   | 1.0秒    | 火焰溅射 |
| 暗影法师   | ⭐⭐⭐      | 150金 | 900    | 22     | 2      | 18       | 100像素  | 100像素  | 2.5秒    | 穿透攻击 |
| 地狱犬     | ⭐⭐⭐      | 150金 | 1100   | 30     | 3      | 35       | 25像素   | 63像素   | 0.8秒    | 火焰吐息 |
| 树人守护者 | ⭐⭐⭐⭐     | 200金 | 2000   | 35     | 10     | 10       | 40像素   | 100像素  | 2.0秒    | 缠绕攻击 |
| 魅魔       | ⭐⭐⭐⭐     | 200金 | 1500   | 32     | 5      | 22       | 70像素   | 70像素   | 1.8秒    | 魅惑控制 |
| 暗影领主   | ⭐⭐⭐⭐⭐    | 400金 | 3200   | 55     | 12     | 25       | 60像素   | 60像素   | 1.5秒    | 形态切换 |
| 骨龙       | ⭐⭐⭐⭐⭐    | 600金 | 4000   | 60     | 18     | 30       | 50像素   | 125像素  | 2.0秒    | 骨刺风暴 |
| 石魔像     | ⭐⭐⭐⭐⭐    | 400金 | 4500   | 45     | 25     | 8        | 40像素   | 100像素  | 2.5秒    | 岩石护盾 |

### ⚔️ 入侵英雄战斗一览表

| 英雄类型 | 生命值 | 攻击力 | 护甲值 | 移动速度 | 攻击范围 | 追击范围 | 攻击速度 | 威胁等级 | 特殊能力 |
| -------- | ------ | ------ | ------ | -------- | -------- | -------- | -------- | -------- | -------- |
| 骑士     | 900    | 18     | 5      | 20       | 35像素   | 88像素   | 1.2秒    | ⭐⭐       | 稳定输出 |
| 弓箭手   | 700    | 16     | 2      | 25       | 120像素  | 120像素  | 1.0秒    | ⭐⭐       | 精准射击 |
| 法师     | 500    | 22     | 1      | 18       | 100像素  | 100像素  | 2.0秒    | ⭐⭐       | 火球术   |
| 牧师     | 800    | 10     | 3      | 18       | 80像素   | 80像素   | 1.5秒    | ⭐⭐       | 治疗术   |
| 盗贼     | 600    | 28     | 1      | 40       | 25像素   | 63像素   | 0.6秒    | ⭐⭐       | 偷窃技能 |
| 圣骑士   | 1600   | 28     | 10     | 15       | 40像素   | 100像素  | 1.5秒    | ⭐⭐⭐      | 神圣光环 |
| 刺客     | 900    | 38     | 3      | 35       | 25像素   | 63像素   | 0.8秒    | ⭐⭐⭐      | 暗杀技能 |
| 游侠     | 1000   | 25     | 4      | 22       | 150像素  | 150像素  | 1.2秒    | ⭐⭐⭐      | 追踪箭   |
| 大法师   | 800    | 35     | 2      | 16       | 120像素  | 120像素  | 2.5秒    | ⭐⭐⭐      | 连锁闪电 |
| 德鲁伊   | 1300   | 22     | 6      | 20       | 80像素   | 80像素   | 1.8秒    | ⭐⭐⭐      | 自然形态 |
| 狂战士   | 1200   | 42     | 3      | 28       | 30像素   | 75像素   | 0.8秒    | ⭐⭐⭐      | 狂暴状态 |
| 工程师   | 1100   | 20     | 6      | 15       | 60像素   | 60像素   | 2.0秒    | ⭐⭐⭐      | 建造炮台 |
| 龙骑士   | 2200   | 48     | 12     | 25       | 45像素   | 113像素  | 1.8秒    | ⭐⭐⭐⭐     | 龙息攻击 |
| 暗影剑圣 | 1400   | 58     | 8      | 30       | 35像素   | 88像素   | 1.0秒    | ⭐⭐⭐⭐⭐    | 暗影步   |

## 🏗️ 战斗机制

### 1. 战斗触发条件
- **战斗触发距离**: 120像素
- **攻击判定距离**: 30像素
- **攻击冷却时间**: 1秒

### 2. 追击范围系统
- **近战单位**: 追击范围 = 攻击范围 × 2.5
- **远程单位**: 追击范围 = 攻击范围 × 1.0
- **脱离战斗**: 目标离开追击范围时停止追击

### 3. 伤害计算
- **基础伤害**: 直接使用单位攻击力数值
- **伤害应用**: 每次攻击直接扣除目标生命值
- **死亡判定**: 生命值 ≤ 0 时单位死亡并从游戏中移除

### 4. 战斗AI优先级

#### 生物AI (小恶魔)
**AI决策流程**:
1. 扫描120像素范围内的英雄 → 状态: moving
2. 选择最近的英雄作为目标 → 状态: fighting
3. 移动到攻击范围内 (30像素) → 状态: moving
4. 执行攻击 (1秒冷却) → 状态: fighting
5. 重复攻击直到目标死亡或脱离范围

**状态指示器显示**:
- 🔴 红色: 战斗中
- 🟢 绿色: 移动中
- ⚫ 深灰色: 逃跑中 (血量 < 30%)
- 🟠 橙色: 游荡中 (无目标时)

#### 哥布林苦工特殊AI
**战斗优先级**:
1. 检测60像素内的英雄 → 立即逃跑 (状态: fleeing)
2. 寻找安全位置 → 远离英雄方向 (状态: moving)
3. 恢复正常工作 → 继续挖掘任务 (状态: mining/wandering)

**状态指示器显示**:
- ⚫ 深灰色: 逃跑中
- 🟢 绿色: 移动中
- 🟡 黄色: 挖掘中
- 🟠 橙色: 游荡中

#### 英雄AI (骑士)
**AI决策流程**:
1. 扫描120像素范围内的生物
2. 优先攻击攻击力最高的生物
3. 移动到攻击范围内进行战斗
4. 无目标时探索地牢，寻找地牢之心

## 🎮 战斗策略

### 玩家防御策略

#### 1. 单位配置
- **前线战士**: 使用小恶魔作为主要战斗力量
- **后勤支援**: 哥布林苦工提供经济支持
- **数量优势**: 多个生物围攻单个英雄

#### 2. 地形利用
- **挖掘控制**: 限制英雄移动路径
- **狭窄通道**: 迫使英雄单列前进
- **房间布局**: 在关键位置建造防御房间

#### 3. 时机把握
- **早期防御**: 快速召唤生物应对初期英雄
- **经济发展**: 平衡战斗投入与经济建设
- **集中火力**: 多个生物同时攻击一个英雄

### 英雄入侵模式

#### 1. 生成机制
- **基地生成**: 英雄从地图边缘的英雄基地刷新
- **随机性**: 1-3个基地随机分布，增加不确定性
- **生成频率**: 基于游戏平衡参数动态调整

#### 2. 行为模式
- **探索优先**: 优先进入已挖掘区域
- **目标导向**: 最终目标是摧毁地牢之心
- **战斗积极**: 主动寻找并攻击玩家生物

## 📊 战斗数据分析

### 单位对比表

| 单位类型   | 生命值 | 攻击力 | 速度 | 成本  | 攻击范围 | 追击范围 | DPS | 性价比 |
| ---------- | ------ | ------ | ---- | ----- | -------- | -------- | --- | ------ |
| 小恶魔     | 800    | 15     | 25   | 100金 | 30像素   | 75像素   | 15  | 0.15   |
| 哥布林苦工 | 600    | 8      | 20   | 80金  | 30像素   | 无       | 8   | 0.10   |
| 石像鬼     | 1200   | 25     | 18   | 150金 | 35像素   | 88像素   | 21  | 0.14   |
| 火蜥蜴     | 1000   | 28     | 22   | 200金 | 85像素   | 85像素   | 28  | 0.14   |
| 暗影法师   | 900    | 22     | 18   | 150金 | 100像素  | 100像素  | 9   | 0.06   |
| 地狱犬     | 1100   | 30     | 35   | 150金 | 25像素   | 63像素   | 38  | 0.25   |
| 树人守护者 | 2000   | 35     | 10   | 200金 | 40像素   | 100像素  | 18  | 0.09   |
| 魅魔       | 1500   | 32     | 22   | 200金 | 70像素   | 70像素   | 18  | 0.09   |
| 暗影领主   | 3200   | 55     | 25   | 400金 | 60像素   | 60像素   | 37  | 0.09   |
| 骨龙       | 4000   | 60     | 30   | 600金 | 50像素   | 125像素  | 30  | 0.05   |
| 石魔像     | 4500   | 45     | 25   | 400金 | 40像素   | 100像素  | 18  | 0.05   |
| 地精工程师 | 800    | 12     | 25   | 100金 | 100像素  | 无       | 12  | 0.12   |

### 战斗效率计算

#### 基础单位对战分析
**小恶魔 vs 英雄**:
- vs 骑士: 900÷15 = 60秒 (需要3-4个小恶魔)
- vs 弓箭手: 700÷15 = 47秒 (需要2-3个小恶魔)
- vs 法师: 500÷15 = 33秒 (需要2个小恶魔)
- vs 圣骑士: 1600÷15 = 107秒 (需要6-8个小恶魔)

**石像鬼 vs 英雄**:
- vs 骑士: 900÷25 = 36秒 (需要2个石像鬼)
- vs 弓箭手: 700÷25 = 28秒 (1-2个石像鬼)
- vs 圣骑士: 1600÷25 = 64秒 (需要3-4个石像鬼)

**地狱犬 vs 英雄**:
- vs 骑士: 900÷30 = 30秒 (高速度优势)
- vs 刺客: 900÷30 = 30秒 (速度对决)
- vs 盗贼: 600÷30 = 20秒 (轻松击败)

**高级单位对战**:
- 暗影领主 vs 龙骑士: 2200÷55 = 40秒
- 骨龙 vs 暗影剑圣: 1400÷60 = 23秒
- 石魔像 vs 圣骑士: 1600÷45 = 36秒

#### 数量优势阈值
**对抗基础英雄**:
- 3个小恶魔 vs 1个骑士: 理论胜利 (45攻击 vs 900生命)
- 1个石像鬼 vs 1个弓箭手: 绝对优势 (25攻击 vs 700生命)
- 6个小恶魔 vs 1个圣骑士: 势均力敌 (90攻击 vs 1600生命)

**对抗中级英雄**:
- 2个地狱犬 vs 1个刺客: 地狱犬优势 (60攻击 vs 900生命)
- 1个石像鬼 vs 1个法师: 石像鬼绝对优势 (25攻击 vs 500生命)
- 4个小恶魔 vs 1个游侠: 小恶魔数量优势

**对抗高级英雄**:
- 1个暗影领主 vs 1个龙骑士: 暗影领主略优 (3200生命 vs 2200生命)
- 1个骨龙 vs 1个暗影剑圣: 骨龙生命优势 (4000 vs 1400)
- 2个石魔像 vs 1个龙骑士: 石魔像绝对优势 (9000生命 vs 2200)

**实际战斗考虑因素**:
- 生命值x10后战斗持续时间大幅延长
- 护甲值的重要性显著提升
- 远程单位的风筝能力更强
- 物理系统的击退效果影响更大
- 治疗和回复能力价值提升

## 📊 状态指示器系统

### 系统概述
战斗系统集成了统一的状态指示器系统(StatusIndicator)，为所有参战单位提供实时状态可视化。

### 状态指示器规格
- **指示器类型**: 竖向空心长方形
- **尺寸**: 4x8像素
- **边框厚度**: 1像素
- **位置**: 单位右上角，距离边缘2像素

### 状态颜色编码

| 状态        | 颜色   | RGB值           | 描述   | 适用单位     |
| ----------- | ------ | --------------- | ------ | ------------ |
| `fighting`  | 红色   | (255, 0, 0)     | 战斗中 | 所有战斗单位 |
| `moving`    | 绿色   | (0, 255, 0)     | 移动中 | 所有移动单位 |
| `mining`    | 金色   | (255, 215, 0)   | 挖掘中 | 哥布林苦工   |
| `fleeing`   | 深灰色 | (64, 64, 64)    | 逃跑中 | 所有单位     |
| `wandering` | 橙色   | (255, 165, 0)   | 游荡中 | 所有单位     |
| `idle`      | 白色   | (255, 255, 255) | 空闲   | 所有单位     |

## 🔧 技术实现

### 战斗检测系统
战斗检测基于距离计算，当单位间距离小于攻击范围时触发攻击。

### 血条显示
- **触发条件**: 生物受伤时显示血条
- **显示位置**: 生物上方25像素处
- **颜色系统**: 红色背景 + 绿色血量
- **动态更新**: 实时反映当前生命值比例

### 死亡处理
当生物生命值降至0或以下时，单位死亡并从游戏中移除。

## 🎯 平衡性设计

### 核心平衡原则

#### 1. 成本效益平衡
- **小恶魔**: 100金币，15 DPS，性价比0.15，主力战斗单位
- **哥布林苦工**: 80金币，10 DPS，性价比0.125，经济单位
- **英雄**: 免费但强力，需要多个生物合力对抗

#### 2. 速度与力量权衡
- **哥布林苦工**: 高速度(30)，低攻击(10)，适合逃跑和工作
- **小恶魔**: 中等速度(25)，中等攻击(15)，平衡战斗
- **骑士**: 低速度(20)，高攻击(25)，重装战士

#### 3. 数量与质量博弈
- **玩家优势**: 可以召唤多个生物形成数量优势
- **英雄优势**: 单体实力强，质量优势明显
- **战术深度**: 需要合理配置单位比例

## 🚀 战斗技巧

### 新手指南

#### 1. 基础防御
- **快速响应**: 英雄入侵时立即召唤小恶魔
- **集中兵力**: 不要分散生物，集中攻击单个英雄
- **保护苦工**: 让哥布林苦工远离战斗区域

#### 2. 经济与军事平衡
- **初期投资**: 优先召唤1-2个哥布林苦工发展经济
- **军事准备**: 维持2-3个小恶魔作为常备军
- **应急召唤**: 遇到强敌时快速增兵

### 进阶策略

#### 1. 地形战术
- **瓶颈控制**: 在狭窄通道设置防线
- **迂回包抄**: 利用多个通道夹击英雄
- **战略撤退**: 引诱英雄进入不利地形

#### 2. 资源管理
- **动态调整**: 根据威胁等级调整军民比例
- **预警机制**: 提前储备金币应对大规模入侵
- **损失控制**: 及时撤退受伤严重的生物

## 📈 未来发展

### 计划功能
- **新单位类型**: 更多种类的生物和英雄
- **特殊能力**: 魔法攻击、治疗、护盾等
- **阵型系统**: 生物协作和组合技能
- **装备系统**: 为生物装备武器和护甲
- **经验系统**: 生物通过战斗获得经验升级

### 平衡性调整
- **数据收集**: 统计战斗胜率和单位使用率
- **动态平衡**: 根据游戏数据调整单位属性
- **玩家反馈**: 结合社区意见优化战斗体验

## 📝 更新日志

### v2.2 - 追击范围系统优化版本
- ✅ **追击范围修复**: 修复了追击范围设置错误的问题
  - **近战单位**: 追击范围 = 攻击范围 × 2.5
  - **远程单位**: 追击范围 = 攻击范围 × 1.0
- ✅ **战斗平衡**: 远程单位不再过度追击，减少频繁的状态切换
- ✅ **文档更新**: 更新CHARACTER_DESIGN.md和COMBAT_SYSTEM.md文档，包含准确的追击范围数据
- ✅ **系统优化**: 战斗状态更加稳定，提升游戏体验

### v2.1 - 怪物重新平衡版本
- ✅ **成本调整**: 哥布林苦工80金，地精工程师100金，小恶魔100金
- ✅ **数值优化**: 所有怪物数值调整为整数，金币数可被10整除
- ✅ **平衡重设计**: 以新的基准重新平衡所有怪物属性
- ✅ **文档更新**: 更新CHARACTER_DESIGN.md和COMBAT_SYSTEM.md文档

### v2.0 - 状态指示器集成版本
- ✅ **系统集成**: 战斗系统集成StatusIndicator状态指示器
- ✅ **状态可视化**: 所有参战单位显示实时状态
- ✅ **AI行为映射**: AI行为与状态指示器颜色对应
- ✅ **文档更新**: 更新战斗系统文档，包含状态指示器信息

---

## ⚡ 物理系统集成

### 击退效果
战斗系统现已与物理系统深度集成：
- **近战击退**: 所有近战攻击自动触发击退效果
- **体型差异**: 大型单位更容易击退小型单位
- **环境交互**: 击退可能导致撞墙伤害和反弹
- **战术深度**: 位置控制成为重要的战术要素

### 环境战术
- **墙面利用**: 可以故意将敌人击退到墙边造成额外伤害
- **位置控制**: 击退可以改变战场布局
- **风险评估**: 在狭窄空间战斗需要权衡撞墙风险

## 🎉 掌握战斗艺术！

战斗系统是 War for the Overworld 的核心玩法之一。通过合理的单位配置、巧妙的战术运用、精确的时机把握和环境利用，你将能够在这个地下世界中建立起强大的防御体系，抵御一波又一波的英雄入侵！⚔️🏰👹

*记住：最好的防御就是进攻，但最好的进攻需要完美的防御和环境的配合！*