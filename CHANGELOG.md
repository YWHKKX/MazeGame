# 更新日志 (CHANGELOG)

本文档记录了 War for the Overworld Python 版本的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.1.0] - 2025-09-23
### 🎉 稳定版本发布 - 完整地牢管理体验
- **版本里程碑**: 经过15个版本的迭代开发，游戏已达到稳定状态
- **完整功能**: 包含地牢挖掘、建筑建造、生物管理、战斗系统等核心功能
- **工程师系统**: 完整的地精工程师建造和维护系统
- **智能AI**: 所有单位都具备智能行为模式和状态管理
- **现代化UI**: 深色主题、圆角设计、响应式布局的现代化界面
- **跨平台支持**: 支持Windows、macOS、Linux三大平台
- **完整文档**: 包含12个详细的技术文档和使用指南

### 🏗️ 核心系统完善
- **地牢建设系统**: 完整的挖掘、建造、房间管理功能
- **生物管理系统**: 14种英雄角色 + 12种怪物角色的完整角色体系
- **战斗系统**: 实时战斗、物理效果、击退系统、自动回血
- **资源管理**: 黄金、法力、食物、原始黄金四种资源系统
- **移动系统**: A*寻路算法、智能避障、多种移动模式
- **状态指示器**: 统一的生物状态可视化系统
- **攻击特效**: 完整的粒子特效、投射物、区域效果系统

### 🔧 技术架构
- **模块化设计**: 清晰的代码组织结构，易于维护和扩展
- **统一管理**: 字体、颜色、样式、常量的统一管理系统
- **性能优化**: 空间哈希、对象池、视野裁剪等优化技术
- **跨平台兼容**: 自动字体检测、路径处理、输入兼容
- **代码质量**: 完整的错误处理、日志系统、调试支持

### 📚 文档体系
- **用户文档**: 角色图鉴、建筑系统、状态指示器、独立版本
- **技术文档**: 物理系统、战斗系统、挖矿系统、移动系统
- **设计文档**: UI美化、攻击特效、箭塔效果
- **开发文档**: 完整的API文档和实现指南

### 🎮 游戏体验
- **策略深度**: 资源管理、空间规划、时机把握、战术配合
- **视觉体验**: 现代化UI、流畅动画、直观反馈、中文支持
- **操作友好**: 一键启动、键盘快捷键、鼠标控制、实时反馈
- **内容丰富**: 多种建筑类型、丰富的角色选择、复杂的AI行为

---

## [1.0.15] - 2025-09-23
### 🔧 工程师系统优化与自动拒绝机制
- **工程师管理优化**: 建筑现在可以自动管理分配的工程师，拒绝多余工程师
  - 🏗️ 智能工程师分配: 建筑自动检查工程师数量，只保留需要的工程师
  - 🚫 自动拒绝机制: 当工程师数量超过需求时，自动拒绝多余的工程师
  - ⚡ 空闲状态优化: 工程师空闲1秒后自动转为游荡状态，提高工作效率
  - 🔄 状态管理: 工程师状态变化时自动从工作列表中移除
- **建造系统改进**: 工程师建造系统更加智能和高效
  - 💰 金币管理: 工程师在投入金币前先检查是否应该被拒绝
  - 🎯 工作优先级: 工作优先于游荡，持续检查新任务
  - 📊 状态指示器: 实时显示工程师的工作状态和建造进度
  - 🏗️ 建筑集成: 工程师与建筑系统完全集成，支持自动任务分配

### 🔧 技术实现
- **Building类扩展**: 新增工程师管理和拒绝机制
  - `auto_reject_excess_engineers()`: 自动拒绝多余工程师方法
  - `should_reject_specific_engineer()`: 检查特定工程师是否应该被拒绝
  - `process_engineer_list()`: 处理工程师列表，保留需要的工程师
- **Engineer类优化**: 改进工程师状态管理和移动系统
  - 空闲转游荡: 工程师空闲1秒后自动转为游荡状态
  - 工作列表管理: 工程师状态变化时自动从工作列表中移除
  - 建造前检查: 在投入金币前检查是否应该被拒绝
- **代码清理**: 删除不必要的调试日志，保持代码整洁

### 📚 文档更新
- **BUILDING_SYSTEM.md**: 更新工程师系统说明，添加自动拒绝机制
- **STATUS_INDICATOR.md**: 添加工程师状态指示器优化说明
- **MOVEMENT_SYSTEM.md**: 更新工程师移动系统支持信息
- **COMBAT_SYSTEM.md**: 添加工程师战斗状态管理说明
- **MINING_SYSTEM.md**: 添加工程师挖掘系统支持信息
- **PHYSICS_SYSTEM.md**: 添加工程师物理交互说明
- **CHARACTER_DESIGN.md**: 更新工程师角色设计信息
- **UI_BEAUTIFICATION.md**: 添加工程师UI美化说明
- **ATTACK_EFFECTS_SYSTEM.md**: 添加工程师攻击特效信息
- **ARROW_TOWER_EFFECTS.md**: 添加工程师箭塔效果说明
- **STANDALONE.md**: 更新独立版本工程师功能说明
- **README.md**: 更新文档导航和最新更新信息

### 🎯 系统优化
- **工程师效率**: 工程师现在更加智能，不会浪费资源
- **建筑管理**: 建筑可以自动管理工程师，避免资源浪费
- **状态优化**: 工程师状态转换更加流畅，提高工作效率
- **代码质量**: 删除调试日志，提高代码可读性和维护性

---

## [1.0.14] - 2025-09-23
### 🏦 金库存储系统优化
- **金库维护成本修复**: 修复了金库金币产出为-1的问题，将维护成本设置为0
  - 🚫 零维护成本: 金库重写`_update_maintenance()`方法，完全禁用维护成本
  - 💰 纯存储功能: 金库作为存储设施，不产生被动收入也不消耗维护成本
  - ⚖️ 经济平衡: 解决了金库持续消耗金币影响经济平衡的问题
- **资源面板集成**: 金库中存储的金币现在会计算到资源面板的总金币显示中
  - 📊 总金币计算: 在`GameState`中添加`get_total_gold()`方法，计算包括金库存储的总金币
  - 🎨 UI显示优化: 资源面板现在显示包括金库存储的准确总金币数量
  - 🔗 建筑管理器集成: 资源面板接收建筑管理器参数，实时计算金库存储
- **存储逻辑优化**: 金库存储系统完全重构，提供更好的用户体验
  - 🏦 独立存储: 每个金库提供500金币独立存储容量，与主基地完全分离
  - 🎯 智能选择: 苦工和工程师优先选择距离200像素内的金库进行存储
  - 📝 详细日志: 存储操作包含建筑名称、坐标和当前存储状态

### 🔧 技术实现
- **Treasury类优化**: 重写维护成本方法，确保金库不消耗金币
- **GameState扩展**: 添加总金币计算方法，支持建筑管理器参数
- **UI系统升级**: 资源面板接收建筑管理器参数，显示准确的总金币
- **代码清理**: 删除了不必要的测试文件和日志文件，保持项目整洁

### 📚 文档更新
- **BUILDING_SYSTEM.md**: 更新金库功能说明，添加零维护成本和资源面板集成信息
- **MINING_SYSTEM.md**: 添加金库存储系统优化版本说明
- **MOVEMENT_SYSTEM.md**: 添加金库存储系统优化改进说明
- **技术细节**: 详细说明金库维护成本修复和资源面板集成的实现机制

### 🎯 系统优化
- **经济平衡**: 金库作为纯存储设施，不产生收入也不消耗成本
- **用户体验**: 玩家可以清楚看到包括金库存储的总金币数量
- **存储效率**: 金库存储的金币完全计入总资源，提高存储价值
- **性能稳定**: 修复了金库维护成本导致的资源消耗问题

---

## [1.0.13] - 2025-09-23
### 🚀 A*寻路系统优化与深度优先搜索修复
- **智能寻路算法**: 为所有单位（英雄、怪物、苦工、工程师）集成A*寻路算法
  - 🧠 A*算法实现: 使用启发式搜索找到最优路径
  - 📐 矩形路径优化: 针对矩形地图的L形路径算法，优先考虑水平和垂直移动
  - 🔮 路径模拟预检查: 在开始移动前验证路径可行性，避免无效移动
  - 🎭 智能游荡状态: 路径不可行时自动进入游荡状态，避免单位卡住
  - 🛣️ 路径平滑: 自动移除不必要的中间点，减少移动步数
  - 🔍 卡住检测: 检测单位是否卡住并自动重新计算路径
  - 🔄 替代路径: 当主要路径被阻塞时寻找替代路线
  - 🚧 动态障碍物处理: 实时检测并绕过新出现的障碍物
  - ⚡ 智能路径阻塞检测: 立即检测路径是否被阻塞并重新计算
- **深度优先搜索系统修复**: 修复了DFS寻路系统的关键问题
  - 🚫 防止重复模拟: 添加`path_simulation_failed`标志，确保路径模拟只进行一次
  - ⚡ 失败后立即进入空闲状态: 路径不可行时单位立即进入游荡状态，不再卡在寻路循环
  - 🔄 智能重置机制: 目标改变时自动重置失败标志，允许重新尝试寻路
- **苦工提前停止移动问题修复**: 修复了苦工在到达金矿前就提前停止移动的问题
  - 📏 真正的距离检查: 在路径到达末尾时添加实际距离验证，确保单位真正到达目标范围
  - 🎯 精确到达判断: 只有当距离≤20px时才认为真正到达目标，否则继续使用直线移动
  - 🔄 平滑移动过渡: 从瓦块路径到直线移动的无缝切换，确保单位能够到达挖掘范围

### 🔧 技术实现
- **MovementSystem类扩展**: 新增高级寻路功能和修复
  - `smart_target_seeking_movement_with_simulation()`: 带路径模拟的智能移动方法
  - `simulate_path_execution()`: 路径模拟预检查方法
  - `find_rectangular_path()`: 矩形路径寻找方法
  - `optimize_rectangular_path()`: 矩形路径优化方法
  - `_build_l_path()`: L形路径构建方法
  - `_can_move_directly()`: 直线移动检测方法
  - `_is_path_blocked()`: 路径阻塞检测方法
  - `smooth_path()`: 路径平滑优化方法
  - `_has_line_of_sight()`: 直线视野检测方法
  - `find_alternative_path()`: 替代路径寻找方法
  - `_get_blocked_tiles_around()`: 周围障碍物检测方法
  - `_dfs_path_find()`: 深度优先搜索路径寻找方法
  - `path_simulation_failed`标志: 防止重复进行路径模拟
  - 真正的距离检查: 在路径末尾验证到目标的实际距离
  - 智能状态管理: 失败后立即进入游荡状态，避免卡住
- **单位移动升级**: 所有单位现在使用智能寻路系统
  - 英雄单位: 追击和探索时使用智能寻路
  - 怪物单位: 攻击和追击时使用智能寻路
  - 苦工单位: 前往金矿和存储时使用智能寻路
  - 工程师单位: 建造和资源收集时使用智能寻路
- **性能优化**: 路径缓存和智能重新计算机制
- **调试信息增强**: 添加详细的DFS搜索日志和路径诊断信息
  - 显示搜索成功/失败状态和路径长度
  - 提供瓦片类型和可通行性调试信息
  - 帮助诊断寻路失败的具体原因

### 📚 文档更新
- **MOVEMENT_SYSTEM.md**: 更新移动系统文档，添加智能寻路功能和DFS系统修复说明
- **技术细节**: 详细说明A*算法实现、优化策略和深度优先搜索修复机制

## [1.0.12] - 2025-09-23
### 🆕 状态指示器系统整合
- **建筑状态高亮系统**: 将建筑状态高亮整合到StatusIndicator系统中
  - 🏗️ 建筑状态支持: 未完成、被摧毁、受损建筑的状态高亮
  - 🎨 边框高亮样式: 只绘制边框，不填充中间区域，保持建筑外观清晰
  - 🔴 未完成建筑: 红色边框高亮（2px边框）
  - 🔴 被摧毁建筑: 深红色粗边框高亮（4px边框）
  - 🟡 受损建筑: 黄色边框高亮（3px边框）

- **金矿状态高亮系统**: 将金矿挖掘状态高亮整合到StatusIndicator系统中
  - ⛏️ 金矿状态支持: 正常、繁忙、满员、枯竭矿脉的状态高亮
  - 🟢 正常挖掘: 绿色边框（1个挖掘者，2px边框）
  - 🟡 较多挖掘者: 黄色边框（2个挖掘者，2px边框）
  - 🔴 满员挖掘: 红色边框（3个挖掘者，3px边框）
  - 🟤 枯竭矿脉: 棕色显示（无边框）

### 🔧 技术实现
- **StatusIndicator类扩展**: 新增建筑和金矿状态的颜色配置和渲染方法
  - `render_building_highlight()`: 建筑状态高亮渲染方法
  - `render_mining_highlight()`: 金矿状态高亮渲染方法
  - 统一的边框高亮样式，支持不同边框宽度
- **主游戏集成**: 移除旧的高亮方法，使用统一的StatusIndicator系统
- **向后兼容**: 保持现有功能不受影响，金矿挖掘状态支持回退机制

### 📚 文档更新
- **STATUS_INDICATOR.md**: 添加建筑和金矿状态的颜色编码表和API文档
- **BUILDING_SYSTEM.md**: 添加建筑状态高亮系统说明
- **MINING_SYSTEM.md**: 更新金矿状态指示器说明
- **UI_BEAUTIFICATION.md**: 添加状态指示器系统的新增功能说明

### 🎯 系统优化
- **代码整合**: 将分散的高亮逻辑统一到StatusIndicator系统中
- **视觉一致性**: 所有状态高亮都使用统一的设计规范
- **性能优化**: 减少重复代码，提高渲染效率
- **可维护性**: 模块化设计，易于扩展和维护

---

## [1.0.11] - 2025-09-22

### 🆕 重大功能完善
- **地精工程师系统**: 完整实现了基于BUILDING_SYSTEM.md的工程师建造系统
  - 🏗️ 工程师状态机: 空闲、游荡、获取资源、前往工地、建造、修理、升级、返回基地
  - 💰 智能金币管理: 每次最少携带60金币，建造耗尽才补充，无目标时归还所有金币
  - ⚡ 建造速度优化: 每秒投入4金币，每5次投入显示一次日志
  - 🎯 工作优先级: 工作优先于游荡，持续检查新任务

### 🔧 工程师核心功能
- **状态指示器系统**: 横向空心长方形指示器，统一状态可视化
- **移动系统集成**: 使用统一的MovementSystem进行所有移动操作
- **建筑管理器集成**: 与building_manager完全兼容，智能分配任务
- **金币管理逻辑**: 
  - 获取时补充到最大值60金币
  - 建造时金币耗尽才回主基地补充
  - 无目标建筑时归还所有金币

### 🎨 UI/UX 改进
- **状态指示器样式**: 修改为横向空心长方形(8x4像素)
- **颜色系统优化**: mining和constructing状态使用深棕色(139, 69, 19)
- **日志系统**: 建造进度每5次投入显示一次，减少日志噪音
- **视觉一致性**: 所有生物使用统一的状态指示器样式

### 🐛 重要修复
- **游荡状态逻辑**: 修复了工程师在游荡和空闲状态间的无效循环
- **建筑可用性检查**: 修复了建筑被错误标记为"正在工作"的问题
- **移动速度一致性**: 统一了工程师在不同状态下的移动速度
- **状态转换优化**: 确保工程师能够正确响应新任务

### 🔄 系统集成
- **工程师与苦工**: 两种单位都使用统一的状态指示器系统
- **建筑系统兼容**: 工程师完全兼容现有的建筑管理系统
- **移动系统统一**: 所有单位使用相同的MovementSystem框架
- **状态管理优化**: 清晰的状态优先级和转换逻辑

### 📚 文档完善
- **工程师系统文档**: 完整的工程师行为逻辑和状态机文档
- **状态指示器文档**: 详细的指示器样式和使用说明
- **移动系统文档**: 统一的移动系统技术规范
- **建筑系统文档**: 工程师与建筑系统的集成说明

### 🎯 技术实现
- **Engineer类**: 完整的工程师实体类，继承自Creature
- **EngineerStatus枚举**: 8种工程师状态的完整定义
- **EngineerConfig类**: 工程师配置数据结构
- **EngineerRegistry类**: 工程师注册表和管理器
- **状态指示器渲染**: 统一的render_status_indicator方法

### 📁 新增/修改文件
- `src/entities/goblin_engineer.py` - 完整的工程师系统实现
- `src/entities/goblin_worker.py` - 添加状态指示器支持
- `src/ui/status_indicator.py` - 状态指示器样式和颜色优化
- `src/managers/building_manager.py` - 建筑可用性检查逻辑优化

### 🎮 游戏体验提升
- **工程师工作效率**: 智能的任务分配和资源管理
- **视觉反馈**: 清晰的状态指示和进度显示
- **操作简化**: 自动化的资源管理和任务分配
- **系统稳定性**: 修复了多个状态转换和逻辑问题

---

## [1.0.10] - 2025-09-21

### 🆕 重大新增功能
- **完整物理系统**: 基于PHYSICS_SYSTEM.md设计的完整物理交互框架
  - ⚡ 碰撞检测系统: 所有单位都有碰撞体积，使用圆形碰撞检测
  - 💥 击退效果系统: 近战攻击自带击退效果，基于体型差异计算
  - 🏗️ 环境碰撞系统: 击退撞墙造成伤害和物理反弹
  - 🎨 击退动画系统: 粒子效果、闪烁效果和屏幕震动
  - 🚀 性能优化: 空间哈希算法和对象池内存管理

### ⚡ 物理系统核心功能
- **体型差击退算法**: 
  - 骨龙(35)击退哥布林(12): 50像素极强击退
  - 哥布林(12)击退骨龙(35): 5像素轻微击退
- **攻击类型修正**: 重击1.5倍、范围0.8倍、魔法0.6倍
- **特殊物理状态**: 
  - 石魔像: 岩石护盾减少击退
  - 树人守护者: 可扎根免疫击退
  - 圣骑士: 神圣护盾减少击退

### 🏗️ 环境碰撞系统
- **撞墙伤害系统**: 击退撞墙造成2-15点额外伤害
- **建筑类型差异化**:
  - 普通墙面: 标准伤害 (1.0x)
  - 地牢之心: 魔法保护 (0.5x)
  - 英雄基地: 更坚硬 (1.2x)
  - 地图边界: 最坚硬 (1.5x)
- **物理反弹系统**: 基于反射定律的真实反弹效果
- **撞墙视觉效果**: 
  - 差异化粒子颜色（墙面灰色、建筑棕色、魔法紫色等）
  - 强化屏幕震动和闪烁效果

### 🧙‍♂️ 召唤系统改进
- **位置占用检测**: 召唤前检查位置是否被其他单位占用
- **智能视觉反馈**: 三色鼠标高亮系统
  - 红色: 地形不合适
  - 橙色: 位置被占用
  - 青色: 可以召唤
- **防止意外移动**: 如果位置被占用则拒绝召唤，不再弹开现有单位
- **碰撞半径计算**: 使用物理系统的精确碰撞检测算法

### 🔧 技术实现
- **PhysicsSystem类**: 核心物理系统管理器
- **EnvironmentCollisionDetector类**: 环境碰撞检测器
- **KnockbackAnimation类**: 击退动画和视觉效果
- **SpatialHash类**: 空间哈希优化碰撞检测性能
- **位置检查算法**: 召唤位置的智能占用检测

### 📊 性能优化
- **空间哈希算法**: 大幅提升大量单位的碰撞检测性能
- **对象池管理**: 减少击退计算的内存分配开销
- **智能检测**: 只在需要时进行位置占用检查
- **高效算法**: 避免开方运算的快速距离检测

### 🎮 游戏体验提升
- **战术深度**: 体型优势、环境利用和位置控制
- **视觉冲击**: 丰富的击退和撞墙特效
- **用户友好**: 清晰的召唤位置反馈
- **物理真实感**: 符合直觉的击退和反弹效果

### 📁 新增文件
- `src/systems/physics_system.py` - 核心物理系统
- `src/systems/knockback_animation.py` - 击退动画系统
- `src/systems/__init__.py` - 系统模块初始化

### 🐛 重要修复
- **PhysicsSystem类结构**: 修复了类定义缩进错误导致的方法丢失问题
- **update方法**: 确保PhysicsSystem.update方法正确属于类
- **环境碰撞集成**: 修复了游戏主循环中的物理系统调用

### 📚 文档更新
- **PHYSICS_SYSTEM.md**: 整合了环境碰撞系统文档
- **STATUS_INDICATOR.md**: 整合了召唤系统改进文档
- **COMBAT_SYSTEM.md**: 添加了物理系统集成说明
- **DEVELOPMENT_GUIDE.md**: 更新了最新系统集成信息
- **README.md**: 更新了文档导航和版本历史

### 🎯 测试验证
- ✅ 物理系统单元测试全部通过
- ✅ 环境碰撞功能测试验证
- ✅ 召唤位置检测测试完成
- ✅ 游戏集成测试正常运行

---

## [1.0.9] - 2024-12-XX

### 🆕 新增功能
- **完整攻击特效系统**: 实现了基于CHARACTER_DESIGN.md文档的全面攻击特效系统
  - 🎆 粒子特效系统: 火花、烟雾、血液等粒子效果
  - 🏹 投射物系统: 弓箭、火球、魔法弹等飞行特效
  - 🌊 区域特效系统: 爆炸、闪电、火焰区域等范围特效
  - 💥 伤害数字系统: 动态显示伤害数值和类型
  - 🎨 特效渲染器: 统一的特效渲染管理系统

### ⚔️ 特效类型支持
- **近战攻击特效**: 
  - 普通斩击 (melee_slash) - 骑士、小恶魔等
  - 重击 (melee_heavy) - 石像鬼、狂战士等
  - 暗影斩击 (shadow_slash) - 刺客、暗影剑圣等
  - 神圣打击 (divine_strike) - 圣骑士
- **远程攻击特效**:
  - 弓箭射击 (arrow_shot) - 弓箭手、工程师
  - 精准射击 (precise_arrow) - 弓箭手特殊能力
  - 追踪箭 (tracking_arrow) - 游侠
  - 火球术 (fireball) - 法师
  - 连锁闪电 (chain_lightning) - 大法师
- **魔法攻击特效**:
  - 火焰吐息 (fire_breath) - 龙骑士、地狱犬
  - 火焰溅射 (fire_splash) - 火蜥蜴
  - 骨刺风暴 (spine_storm) - 骨龙
  - 酸液喷射 (acid_spray) - 新增怪物能力
  - 魅惑效果 (charm_effect) - 魅魔
- **自然魔法特效**:
  - 自然箭 (nature_arrow) - 德鲁伊
  - 藤蔓缠绕 (vine_entangle) - 树人守护者

### 🔧 技术实现
- **EffectManager类**: 中央特效管理器，统一创建和更新所有特效
- **ParticleSystem类**: 粒子特效系统，处理火花、烟雾等粒子效果
- **ProjectileSystem类**: 投射物系统，管理飞行攻击元素
- **AreaEffectSystem类**: 区域特效系统，处理范围攻击效果
- **EffectRenderer类**: 特效渲染器，负责绘制所有视觉特效
- **EffectPool类**: 对象池系统，优化性能通过重用特效对象

### 🚀 性能优化
- **智能性能管理**: 根据负载自动调整特效质量
  - 正常模式: 创建完整特效
  - 降级模式: 减少粒子数量到1/3
  - 节能模式: 完全跳过特效创建
- **特效冷却机制**: 100毫秒冷却时间，防止同一位置特效过于频繁
- **网格化冷却系统**: 按10像素网格分组，避免过于精确的位置判断
- **内存清理机制**: 自动清理过期的冷却记录，防止内存泄漏
- **更新频率优化**: 高负载时降低特效系统更新频率

### 📊 性能指标
- **特效数量限制**: 
  - 最大粒子数: 500个
  - 最大投射物数: 100个
  - 最大区域特效数: 50个
- **性能阈值**: 80%阈值触发降级模式
- **性能提升**: 100次特效创建和更新仅需0.03秒
- **内存控制**: 特效数量得到有效控制，不会无限增长

### 🎮 游戏集成
- **英雄攻击特效**: 所有14种英雄类型都有对应的攻击特效
- **怪物攻击特效**: 所有12种怪物类型都有对应的攻击特效
- **战斗体验增强**: 每次攻击都会产生相应的视觉特效
- **性能稳定**: 特效系统不会影响游戏流畅度

### 📁 新增文件
- `src/effects/` - 特效系统核心模块
  - `effect_manager.py` - 特效管理器
  - `particle_system.py` - 粒子系统
  - `projectile_system.py` - 投射物系统
  - `area_effect_system.py` - 区域特效系统
  - `effect_renderer.py` - 特效渲染器
  - `effect_pool.py` - 对象池系统
- `test_effects.py` - 特效系统测试脚本
- `test_game_effects.py` - 游戏集成测试脚本
- `test_performance_fix.py` - 性能修复测试脚本

### 🐛 修复
- **特效系统初始化问题**: 修复了pygame字体系统未初始化导致的错误
- **Projectile类构造函数**: 修复了trail_points字段缺少默认值的问题
- **战斗逻辑参数缺失**: 修复了standalone_game.py中调用_attack_target时缺少effect_manager参数的问题
- **性能卡顿问题**: 通过智能性能管理解决了特效导致游戏卡顿的问题

### 📚 文档更新
- **ATTACK_EFFECTS_SYSTEM.md**: 完整的攻击特效系统设计文档
- **临时文档组织**: 建立了正式文档和临时文档的分类管理体系
  - 正式文档: 放在`docs/`目录，长期维护的技术规范
  - 临时文档: 放在根目录，记录问题排查和修复过程

### 🎯 用户体验改进
- **视觉体验**: 丰富的攻击特效大大增强了战斗的视觉冲击力
- **性能稳定**: 智能性能管理确保游戏运行流畅
- **兼容性**: 特效系统与现有游戏逻辑完美集成
- **可扩展性**: 模块化设计便于添加新的特效类型

---

## [1.0.8] - 2025-09-20

### 🆕 新增功能
- **完整角色图鉴系统**: 基于CHARACTER_DESIGN.md文档的完整角色管理系统
  - 📚 角色数据定义: 10个英雄角色 + 8个怪物角色的完整数据
  - 🎨 图鉴UI系统: 现代化的深色主题界面，支持搜索和收藏
  - 🔍 搜索功能: 支持中英文角色名称实时搜索
  - ❤️ 收藏系统: 可以收藏喜欢的角色，支持收藏列表保存/加载
  - 🖼️ 头像显示: 自动加载真实头像图片，无头像时显示颜色圆形
  - 📊 详细信息: 显示角色的完整属性、特殊能力、AI行为和战术特点

### 🎮 图鉴功能特性
- **角色浏览**: 英雄角色和怪物角色分类显示
- **实时搜索**: 输入文字即时过滤角色列表
- **收藏管理**: 点击❤️按钮收藏/取消收藏角色
- **数据导出**: 支持将角色数据导出为JSON格式
- **统计信息**: 显示总角色数、收藏数、头像数量等统计

### 🔧 技术实现
- **CharacterData类**: 完整的角色数据结构定义
- **CharacterDatabase类**: 角色数据库管理器
- **CharacterBestiary类**: 图鉴UI系统和交互逻辑
- **头像缓存系统**: 自动加载和缓存角色头像图片
- **事件处理系统**: 完整的键盘和鼠标事件处理

### 📁 新增文件
- `character_data.py`: 角色数据定义和数据库
- `character_bestiary.py`: 角色图鉴UI系统
- `test_bestiary.py`: 图鉴系统测试脚本
- `game_with_bestiary.py`: 集成图鉴的游戏示例
- `run_bestiary.py`: 便捷启动脚本
- `README_BESTIARY.md`: 完整的图鉴系统说明文档

### 🎯 角色数据完整性
- **英雄角色**: 骑士、弓箭手、法师、圣骑士、刺客、游侠、大法师、德鲁伊、龙骑士、暗影剑圣
- **怪物角色**: 小恶魔、哥布林苦工、石像鬼、火蜥蜴、暗影法师、树人守护者、暗影领主、骨龙
- **完整属性**: 生命值、攻击力、移动速度、护甲值、攻击距离、攻击冷却、特殊能力等
- **AI行为**: 每个角色的详细AI行为描述和战术特点

### 🎨 用户体验
- **快捷键支持**: B键打开图鉴，H/M切换类型，F切换收藏视图
- **响应式界面**: 适配不同屏幕尺寸的现代化UI设计
- **直观操作**: 鼠标点击选择角色、收藏角色，滚轮滚动列表
- **视觉反馈**: 选中状态、收藏状态、搜索状态的清晰视觉指示

### 🐛 修复
- **B键事件处理**: 修复了B键无限触发的问题
  - B键现在可以在任何时候切换图鉴状态（打开/关闭）
  - ESC键只能关闭图鉴，不会导致重复触发
  - 事件处理逻辑优化，避免冲突和重复处理
- **主游戏集成**: 将角色图鉴系统完全集成到主游戏中
  - 在standalone_game.py中添加了完整的图鉴系统集成
  - B键现在可以在主游戏中正常打开/关闭角色图鉴
  - 图鉴事件优先处理，确保与游戏事件不冲突
  - 添加了安全的模块导入机制，图鉴不可用时游戏仍能正常运行
- **B键事件修复**: 修复了B键事件处理的问题
  - 现在B键可以正常打开/关闭图鉴 (pygame.K_b对应物理B键)
  - 修复了pygame键盘事件处理逻辑
  - 所有测试脚本已更新并验证B键功能正常
- **中文字体支持**: 修复了角色图鉴中的中文乱码问题
  - 添加了完整的中文字体管理器到图鉴系统
  - 支持Windows/macOS/Linux系统的中文字体自动检测
  - 实现了安全的文本渲染机制，防止乱码显示
  - 创建了中文字体测试脚本验证显示效果
- **控制修复**: 修复了B键和WASD移动失效的问题
  - 添加了unicode事件处理支持，解决键盘输入兼容性问题
  - 修复了B键无法打开图鉴的问题
  - 修复了WASD键无法移动相机的问题
  - 创建了控制测试脚本验证修复效果
- **输入法兼容性**: 彻底解决了输入法导致的按键失效问题
  - 实现了增强的按键检测方法，同时支持物理按键和unicode字符
  - 添加了pygame按键重复设置，提高输入法兼容性
  - 修复了中文输入法状态下按键无法响应的问题
  - 创建了专门的输入法测试脚本验证修复效果
- **代码清理**: 清理了开发过程中的测试文件和调试脚本
  - 删除了所有临时测试脚本（debug_*.py, test_*.py）
  - 删除了示例和演示文件（game_with_bestiary.py, run_bestiary.py等）
  - 保留了核心功能文件和文档
  - 项目结构更加清晰，便于维护
- **新单位扩展**: 基于CHARACTER_DESIGN.md文档设计了全新的角色单位
  - **新增4个英雄**: 狂战士、牧师、盗贼、工程师
  - **新增4个怪物**: 地狱犬、石魔像、魅魔、地精工程师
  - **完整属性设计**: 每个新单位都有详细的属性、技能和AI行为
  - **平衡性考虑**: 新单位填补了原有角色体系的空白
  - **文档更新**: 完整更新了CHARACTER_DESIGN.md文档
- **游戏角色集成**: 将图鉴系统完全集成到游戏逻辑中
  - **英雄系统升级**: Hero类现在使用character_data.py中的丰富角色数据
  - **怪物系统升级**: Creature类现在使用character_data.py中的角色数据
  - **随机英雄生成**: 英雄入侵现在会随机选择图鉴中的14种英雄类型
  - **动态成本系统**: 召唤怪物时使用图鉴中定义的真实成本
  - **扩展召唤选项**: 新增6-9数字键召唤地狱犬、石魔像、魅魔、地精工程师
  - **角色名称显示**: 游戏中显示角色的中文名称而不是ID
  - **金币转换机制**: 修复了原始黄金自动转换为金币的问题
  - **召唤系统优化**: 召唤怪物时自动使用原始黄金补足金币不足
- **完整怪物系统**: 实现了所有12种怪物的召唤系统
  - **新增6种怪物**: 石像鬼、火蜥蜴、暗影法师、树人守护者、暗影领主、骨龙
  - **智能按键系统**: 数字键4-9,0召唤基础怪物，字母键Q,E,R,T,Y召唤高级怪物
  - **完整召唤逻辑**: 所有怪物都可以通过按键直接召唤
  - **成本动态显示**: UI中显示每个怪物的真实成本
  - **扩展控制说明**: 更新了控制说明以包含新的按键
- **怪物召唤UI系统**: 重新设计召唤界面，提供更好的用户体验
  - **简化按键绑定**: 只保留4键召唤怪物和5键召唤苦工
  - **怪物选择UI**: 4键弹出美观的选择界面，支持鼠标点击和数字键选择
  - **网格布局**: 3x4网格显示所有11种怪物，清晰展示名称和成本
  - **交互优化**: 支持鼠标点击、数字键1-9,0快速选择、ESC取消
  - **视觉改进**: 半透明背景、清晰的按钮设计、快捷键提示
  - **控制简化**: 移除了复杂的字母键绑定，专注于核心功能

---

## [1.0.7] - 2025-09-19

### 🆕 新增功能
- **完整战斗系统**: 实现了完整的实时战斗机制
  - 战斗检测系统：30像素攻击判定距离，1秒攻击冷却
  - 伤害计算系统：直接使用攻击力数值造成伤害
  - 死亡处理系统：生命值≤0时自动清理死亡单位
- **智能AI行为**: 改进了生物和英雄的战斗AI
  - 小恶魔主动寻找120像素范围内的英雄进行追击
  - 哥布林苦工遇敌自动逃离（60像素检测范围）
  - 英雄优先攻击威胁最大的生物
- **血条显示系统**: 为所有战斗单位添加了动态血条
  - 受伤时显示血条（生物上方25像素处）
  - 红色背景 + 绿色血量，实时反映生命值比例
  - 符合COMBAT_SYSTEM.md文档规范

### 🔧 技术实现
- **战斗处理系统**: `_handle_combat()` 方法处理所有战斗逻辑
- **攻击方法**: `_attack_target()` 和 `_take_damage()` 处理伤害计算
- **死亡清理**: `_cleanup_dead_units()` 自动清理死亡单位
- **AI行为优化**: 小恶魔新增 `_update_imp_combat_behavior()` 方法

### 📊 战斗平衡
- **小恶魔**: 80生命值，15攻击力，主动战斗单位
- **哥布林苦工**: 60生命值，8攻击力，非战斗单位（优先逃跑）
- **骑士**: 100生命值，20攻击力，强力入侵者
- **战斗距离**: 30像素攻击判定，120像素发现范围

### 💚 自动回血系统
- **脱离战斗回血**: 脱离战斗10秒后开始自动回血
- **回血速度**: 每秒1点生命值
- **战斗状态跟踪**: 准确检测战斗开始和结束
- **智能回血**: 满血时停止回血，避免浪费

### 🔧 回血技术实现
- **战斗状态跟踪**: 添加`in_combat`、`last_combat_time`属性
- **回血参数配置**: `regeneration_rate`（1点/秒）、`regeneration_delay`（10秒）
- **回血处理系统**: `_handle_health_regeneration()` 统一管理回血逻辑
- **单位回血方法**: `_regenerate_health()` 处理单个单位的回血

### 🎮 游戏体验改进
- **持久战斗**: 单位不再因为受伤而永久失去战斗力
- **战术深度**: 鼓励玩家进行战术撤退和重新组织
- **平衡性**: 避免战斗过于激烈导致单位快速死亡
- **策略选择**: 玩家需要在战斗和撤退之间做出选择

---

## [1.0.6] - 2025-09-19

### 🆕 新增功能
- **统一移动系统**: 实现了三种核心移动逻辑的标准化框架
  - 🎯 目标导向移动: 向特定目标的最短路径移动
  - 🏃 逃离移动: 远离威胁目标的智能逃离
  - 🎲 随机游荡移动: 随机移动+等待2-3秒的循环
- **MovementSystem类**: 统一的移动逻辑管理器，所有单位共享
- **智能行为优先级**: 每个单位类型都有明确的行为优先级系统

### 🔧 重构改进
- **代码精简**: 删除了大量重复和复杂的移动相关代码
- **逻辑统一**: 所有单位使用相同的移动基础框架
- **性能优化**: 减少了重复的路径计算和移动验证

### 🐛 关键修复
- **苦工返回逻辑**: 修复了苦工携带满金币后不返回基地的问题
- **挖掘持续性**: 修复了苦工挖掘一次后就停止的问题
- **优先级执行**: 确保正确的行为优先级：逃离 → 存储 → 挖掘 → 游荡

### 📚 文档完善
- **MOVEMENT_SYSTEM.md**: 新增详细的移动系统设计文档
- **技术规范**: 为每种单位制定了具体的移动策略
- **实现指南**: 提供了完整的技术实现参考

### 🎯 行为优化
- **哥布林苦工**: 优化了工作流程，确保携带满后立即返回
- **小恶魔**: 简化了巡逻行为，使用统一的游荡系统
- **英雄**: 改进了探索和战斗的移动逻辑

### 🐛 重要修复
- **金矿人员管理逻辑**: 修复了金矿满员时所有苦工都离开的问题
  - 已注册的挖掘者会继续挖掘，确保金矿始终保持3个苦工
  - 新来的苦工会自动寻找其他可用金矿
  - 改进了挖掘者注册和清理机制
- **目标选择优化**: 苦工选择金矿时会自动排除已满员的金矿
- **挖掘参数调整**: 
  - 挖掘速度从每2秒1.5金币调整为每1秒1金币
  - 金矿储量从50金币调整为500-2000金币（随机）

### 💎 系统改进
- 更智能的金矿容量管理
- 更好的苦工工作分配
- 更稳定的挖掘效率

---

## [1.0.5] - 2025-09-19

### 🆕 新增功能
- **英雄移动限制系统**: 英雄现在只能在已挖掘的地块上移动，增加了战略深度
- **英雄基地系统**: 在地图边缘随机生成1-3个英雄基地🏰
- **英雄基地区域**: 每个英雄基地周围自动生成5x5的已挖掘区域
- **基于基地的英雄生成**: 英雄不再从地图边缘随机生成，而是从英雄基地附近刷新

### 🎨 视觉改进
- **英雄基地标识**: 英雄基地显示为蓝色城堡图标🏰
- **基地区域可视化**: 英雄基地周围的挖掘区域清晰可见
- **生成位置优化**: 英雄基地之间保持足够距离，避免重叠

### 🔧 游戏机制优化
- **战略地形控制**: 玩家可以通过控制挖掘路径来影响英雄的移动
- **多基地平衡**: 1-3个随机数量的基地确保每局游戏的变化性
- **智能基地放置**: 基地自动放置在地图边缘的合适位置
- **基地周围清理**: 自动清除基地区域的金矿，确保英雄生成空间畅通

### 🐛 修复
- 修复了英雄基地属性初始化顺序错误的问题
- 优化了英雄生成逻辑，确保在有效位置生成
- 改进了英雄移动验证，防止英雄卡在无法移动的区域

### 🎯 战略影响
- **防御策略**: 玩家需要考虑如何阻断英雄从基地到地牢之心的路径
- **探索平衡**: 英雄必须通过已挖掘区域才能深入地牢
- **资源竞争**: 英雄基地区域为英雄提供了安全的立足点
- **多线防御**: 多个基地要求玩家制定更复杂的防御策略

---

## [1.0.4] - 2025-09-19

### 🆕 新增功能
- **金币收集存储系统**: 哥布林苦工现在先收集金币到自身，满10个后回基地存储
- **智能工作流程**: 实现了 挖掘 → 收集 → 存储 → 返回工作 的完整循环
- **携带容量管理**: 每个哥布林苦工最多携带10个金币
- **回基地存储机制**: 携带满后自动寻找地牢之心进行存储

### 🎨 视觉改进
- **新增状态图标**: 
  - 🔵 青色🏠: 回基地存储
  - 🔴 红色🏃: 逃跑状态
  - 保持原有的挖掘和移动状态图标
- **携带金币显示**: 哥布林苦工脚下显示当前携带的金币数量
- **容量状态指示**: 金币数量颜色变化（黄色正常，红色表示满载）

### 🔧 AI行为优化
- **四级优先级系统**: 逃离 → 存储 → 挖掘 → 巡逻
- **智能容量管理**: 挖掘时考虑剩余携带空间
- **高效存储路径**: 自动寻找最近的地牢之心进行存储
- **工作状态保持**: 存储完成后继续寻找新的挖掘目标

### 🐛 修复
- 修复了挖掘时不考虑携带容量的问题
- 优化了存储逻辑，确保金币正确转移到游戏资源
- 改进了状态转换的流畅性

---

## [1.0.3] - 2025-09-19

### 🆕 新增功能
- **完善的哥布林苦工AI系统**: 实现了三级优先级行为（逃离 > 挖掘 > 巡逻）
- **智能逃离机制**: 哥布林苦工会在60像素内检测到英雄时自动逃离
- **精确挖掘效率**: 每2秒挖掘1.5单位原始黄金，符合文档规范
- **8格搜索半径**: 哥布林苦工按照文档要求在8格范围内寻找金矿
- **矿脉枯竭系统**: 金矿挖完后变为枯竭状态，显示棕色标识

### 🎨 视觉改进
- **状态指示器**: 哥布林苦工根据不同状态显示不同颜色的图标
  - 🟢 绿色: 移动到矿脉
  - 🟡 黄色: 挖掘中
  - 🟡 黄色: 逃跑中
  - 默认: 空闲状态
- **挖掘状态显示**: 正在被挖掘的金矿显示绿色边框
- **枯竭矿脉标识**: 已枯竭的金矿显示为棕色方块

### 🔧 AI行为优化
- **优先级系统**: 严格按照 逃离 → 挖掘 → 巡逻 的优先级执行
- **智能路径规划**: 哥布林苦工会寻找最近的可达金矿
- **逃离策略**: 计算与英雄相反的方向进行智能逃离
- **资源整合**: 挖掘的原始黄金直接加入游戏资源池

### 🐛 修复
- 修复了哥布林苦工可能卡在无效目标的问题
- 修复了矿脉状态更新不及时的问题
- 优化了生物更新时的参数传递

---

## [1.0.2] - 2025-09-19

### 🆕 新增功能
- **移动限制系统**: 所有生物现在只能在已挖掘的地块上移动
- **起始区域**: 游戏开始时提供8x8的预挖掘区域
- **地牢之心**: 在起始区域中央添加主基地建筑💖
- **智能寻路**: 生物会自动寻找可达的移动目标
- **召唤限制**: 生物只能在已挖掘区域被召唤

### 🔧 改进
- 生物AI现在会考虑地形可通行性
- 哥布林苦工优化了挖矿路径寻找算法
- 英雄会优先进入已挖掘区域进行战斗
- 改进了移动验证系统的性能

### 🐛 修复
- 修复了生物可能卡在不可移动区域的问题
- 修复了Tile类缺少必要属性的错误
- 优化了字体渲染的稳定性

---

## [1.0.1] - 2025-09-19

### 🆕 新增功能
- **中文字体支持系统**: 自动检测并使用系统中文字体
- **字体管理器**: 专门的FontManager类处理字体渲染
- **安全文本渲染**: 防止中文字符渲染错误的保护机制

### 🔧 改进
- 界面完全支持中文显示
- 添加了emoji图标支持💰🔮🍖⚡👹🏆🌊
- 优化了字体选择算法，支持Windows/macOS/Linux
- 改进了UI面板的视觉效果

### 🐛 修复
- 修复了中文字符显示为方块的问题
- 解决了字体初始化失败的异常处理
- 修复了部分UI文本渲染异常

---

## [1.0.0] - 2025-09-19

### 🆕 首次发布
- **核心游戏系统**: 完整的地牢管理游戏框架
- **挖掘系统**: 玩家可以挖掘岩石创建地下空间
- **建造系统**: 支持建造金库、巢穴等房间
- **生物系统**: 召唤和管理小恶魔、哥布林苦工
- **资源管理**: 黄金、法力、食物、原始黄金四种资源
- **战斗系统**: 英雄入侵和实时战斗机制
- **AI系统**: 生物和英雄的智能行为

### 🎮 游戏功能
- **多种建造模式**: 挖掘、建造房间、召唤生物
- **实时策略**: 资源管理和防御策略
- **动态生成**: 随机金矿脉和英雄入侵
- **视觉反馈**: 实时UI更新和状态显示

### 🔧 技术特性
- **Pygame引擎**: 基于Python的游戏开发
- **面向对象设计**: 清晰的代码架构
- **配置系统**: 易于调整的游戏平衡参数
- **跨平台支持**: Windows/macOS/Linux兼容

### 🎯 特殊功能
- **哥布林苦工**: 专门的挖矿单位
- **金矿系统**: 可挖掘的金矿脉资源
- **相机控制**: WASD移动视角
- **多种UI面板**: 资源、建造、状态信息显示

---

## 版本说明

### 版本号格式: [主版本].[次版本].[修订版本]

- **主版本**: 不兼容的API修改
- **次版本**: 向下兼容的功能性新增
- **修订版本**: 向下兼容的问题修正

### 更新类型标识

- 🆕 **新增**: 新功能
- 🔧 **改进**: 现有功能的增强
- 🐛 **修复**: Bug修复
- 🗑️ **移除**: 删除的功能
- 🔒 **安全**: 安全相关修复
- 📚 **文档**: 文档更新

---

## 开发里程碑

- **2025-09-19**: 项目启动，实现核心游戏框架
- **2025-09-19**: 添加中文字体支持系统
- **2025-09-19**: 实现移动限制和起始区域系统

---

*本更新日志将持续更新，记录项目的每一个重要变更。*